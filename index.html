<!DOCTYPE html>
<html lang="en"> <!-- class="dark" is set by script -->
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Munin - Cardano On-Chain Polling (CIP-Aligned)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Almendra&display=swap" rel="stylesheet">
    <style>
        /* --- THEMEING APPROACH WITH CSS VARIABLES --- */
        :root {
            /* Light Theme Palette */
            --bg-body: #e5e7eb; /* gray-200 */
            --bg-panel: rgba(255, 255, 255, 0.8);
            --bg-panel-item: #f3f4f6; /* gray-100 */
            --bg-panel-item-hover: #d1d5db; /* gray-300 */
            --bg-select: #f3f4f6; /* gray-100 */
            --bg-cli-code: #f3f4f6; /* gray-100 */
            --text-primary: #1f2937; /* gray-800 */
            --text-secondary: #4b5563; /* gray-600 */
            --text-tertiary: #6b7280; /* gray-500 */
            --text-cli-code: #1f2937; /* gray-800 */
            --border-color: #d1d5db; /* gray-300 */
            --ring-offset-color: #e5e7eb;

            /* Alert Box Colors - Light Mode (FIXED) */
            --bg-alert-permitted: #d1fae5;    /* green-100 */
            --text-alert-permitted: #065f46;  /* green-800 */
            --border-alert-permitted: #6ee7b7; /* green-300 */
            --bg-alert-not-permitted: #ffedd5;  /* orange-100 */
            --text-alert-not-permitted: #9a3412; /* orange-800 */
            --border-alert-not-permitted: #fdba74; /* orange-300 */
        }

        .dark {
            /* Dark Theme Palette */
            --bg-body-gradient: linear-gradient(to bottom right, #111827, #1e293b);
            --bg-panel: rgba(17, 24, 39, 0.5);
            --bg-panel-item: rgba(55, 65, 81, 0.5); 
            --bg-panel-item-hover: rgba(55, 65, 81, 1);
            --bg-select: #1f2937;
            --bg-cli-code: #1f2937;
            --text-primary: #f3f4f6;
            --text-secondary: #d1d5db;
            --text-tertiary: #9ca3af;
            --text-cli-code: #f472b6;
            --border-color: #374151;
            --ring-offset-color: #1f2937;

            /* Alert Box Colors - Dark Mode */
            --bg-alert-permitted: rgba(16, 185, 129, 0.2);
            --text-alert-permitted: #a7f3d0;
            --border-alert-permitted: #10b981;
            --bg-alert-not-permitted: rgba(249, 115, 22, 0.2);
            --text-alert-not-permitted: #fdba74;
            --border-alert-not-permitted: #f97316;
        }

        /* General Variable Application */
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-body); color: var(--text-primary); }
        .dark body { background-image: var(--bg-body-gradient); }
        .bg-panel { background-color: var(--bg-panel); }
        .bg-panel-item { background-color: var(--bg-panel-item); }
        .bg-panel-item:hover { background-color: var(--bg-panel-item-hover); }
        .bg-select { background-color: var(--bg-select); }
        .bg-cli-code { background-color: var(--bg-cli-code); }
        .text-primary { color: var(--text-primary); }
        .text-secondary { color: var(--text-secondary); }
        .text-tertiary { color: var(--text-tertiary); }
        .text-cli-code { color: var(--text-cli-code); }
        .border-theme { border-color: var(--border-color); }
        .ring-offset-theme { --tw-ring-offset-color: var(--ring-offset-color); }

        /* Alert Box Theming */
        .alert-box {
            background-color: var(--bg-alert-color);
            color: var(--text-alert-color);
            border-color: var(--border-alert-color);
            border-width: 1px;
            padding: 0.75rem;
            border-radius: 0.5rem;
            font-size: 0.875rem;
            line-height: 1.25rem;
            margin-bottom: 1.5rem;
        }
        .alert-permitted {
            --bg-alert-color: var(--bg-alert-permitted);
            --text-alert-color: var(--text-alert-permitted);
            --border-alert-color: var(--border-alert-permitted);
        }
        .alert-not-permitted {
            --bg-alert-color: var(--bg-alert-not-permitted);
            --text-alert-color: var(--text-alert-not-permitted);
            --border-alert-color: var(--border-alert-not-permitted);
        }

        /* Other styles */
        .font-viking { font-family: 'Almendra', serif; }
        .sortable-ghost { opacity: 0.4; background-color: #6366f1; color: white; }
        .sortable-chosen { cursor: grabbing; }
        .highlight-border { border-image-slice: 1; border-image-source: linear-gradient(to right, #4f46e5, #ec4899); }
        .action-item-hover:hover { border-color: #4f46e5 !important; }
        
        .candidate-box {
            cursor: pointer;
            border-width: 2px;
            border-color: transparent;
            transition: border-color 0.2s ease-in-out;
            border-radius: 0.5rem; /* Added border-radius for consistency */
        }
        .candidate-box.expanded {
            border-color: #4f46e5; /* Purple highlight for expanded box */
        }

        /* Custom Modal Styles */
        .custom-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        .custom-modal-content {
            background-color: var(--bg-panel);
            color: var(--text-primary);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: 0 10px 15px rgba(0, 0, 0, 0.1);
            max-width: 90%;
            width: 400px;
            text-align: center;
            position: relative;
        }
        .custom-modal-close-btn {
            position: absolute;
            top: 0.75rem;
            right: 0.75rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-secondary);
        }
    </style>
    <script>
        // Script to set initial theme based on local storage or system preference
        if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>
</head>
<body class="bg-body text-primary transition-colors duration-300">
    <div class="max-w-screen-xl mx-auto p-4 sm:p-6 lg:p-8">
        <header class="mb-10 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-6">
            <div>
                <div class="flex items-center gap-4">
                    <!-- Munin Logo -->
                    <img src="munin.png" alt="Munin Logo" class="w-20 h-20 rounded-lg">
                    <h1 class="font-viking text-5xl sm:text-6xl font-normal text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-pink-500 tracking-wider">Munin</h1>
                </div>
                <p class="mt-2 ml-16 font-semibold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-pink-600">On-chain polling for Cardano Governance.</p>
            </div>
            <div class="flex flex-col items-end gap-4 w-full sm:w-auto">
                    <!-- Theme Toggle Button with SVG Icons -->
                   <button id="theme-toggle-btn" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-800 text-gray-700 dark:text-gray-300 hover:bg-gray-300 dark:hover:bg-gray-700 transition">
                    <svg id="theme-icon-light" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 14.464A1 1 0 106.465 13.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm-1.414-2.12a1 1 0 010-1.414l.707-.707a1 1 0 111.414 1.414l-.707.707a1 1 0 01-1.414 0zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z"/></svg>
                    <svg id="theme-icon-dark" class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
                </button>
                <div class="flex items-center gap-3 sm:gap-4">
                    <div class="flex-grow sm:flex-shrink-0">
                        <label for="role-selector" class="sr-only">Select your role</label>
                        <select id="role-selector" class="w-full bg-select text-primary border-gray-400 dark:border-gray-600 rounded-lg py-2 pl-3 pr-8 focus:ring-purple-500 focus:border-purple-500 transition">
                            <option value="Stakeholder">Stakeholder</option>
                            <option value="DRep">DRep</option>
                            <option value="SPO">SPO</option>
                            <option value="CC">CC Member</option>
                        </select>
                    </div>
                    <button id="connect-wallet-btn" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-4 rounded-lg transition duration-300 whitespace-nowrap shadow-lg shadow-purple-900/40">
                        Connect Wallet
                    </button>
                </div>
            </div>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="bg-panel backdrop-blur-sm p-6 rounded-2xl shadow-lg h-fit">
                <h2 class="text-2xl font-semibold mb-4 text-primary">Governance Actions</h2>
                <div id="governance-actions-list" class="space-y-3 max-h-[70vh] overflow-y-auto pr-2">
                    <!-- Governance actions will be rendered here by JavaScript -->
                </div>
            </div>

            <div class="lg:col-span-2 bg-panel backdrop-blur-sm p-6 rounded-2xl shadow-lg min-h-[60vh]">
                <div id="details-panel">
                    <!-- Details of selected governance action or welcome message will be rendered here -->
                </div>
            </div>
        </main>
    </div>

    <!-- Custom Feedback Modal -->
    <div id="custom-feedback-modal" class="custom-modal-overlay hidden">
        <div class="custom-modal-content">
            <button class="custom-modal-close-btn" onclick="document.getElementById('custom-feedback-modal').classList.add('hidden');">&times;</button>
            <p id="modal-feedback-message" class="text-lg font-medium"></p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Get references to theme toggle elements
            const themeToggleButton = document.getElementById('theme-toggle-btn');
            const lightIcon = document.getElementById('theme-icon-light');
            const darkIcon = document.getElementById('theme-icon-dark');

            /**
             * Updates the visibility of the sun/moon icons based on the current theme.
             */
            function updateThemeIcons() {
                if (document.documentElement.classList.contains('dark')) {
                    lightIcon.classList.remove('hidden');
                    darkIcon.classList.add('hidden');
                } else {
                    lightIcon.classList.add('hidden');
                    darkIcon.classList.remove('hidden');
                }
            }

            /**
             * Toggles the dark theme on/off and saves the preference to local storage.
             */
            function toggleTheme() {
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
                updateThemeIcons(); // Update icons immediately after theme change
            }

            // Add event listener for theme toggle button
            themeToggleButton.addEventListener('click', toggleTheme);
            // Call updateThemeIcons initially to set the correct icon on page load
            updateThemeIcons();

            // Helper function to get social media SVG icon paths
            function getSocialIcon(platform) {
                switch (platform.toLowerCase()) {
                    case 'twitter':
                        return `<path d="M22.46 6c-.85.38-1.78.64-2.75.76a4.91 4.91 0 002.16-2.67 9.87 9.87 0 01-3.13 1.2c-.75-.8-1.8-1.3-3.05-1.3-2.3 0-4.17 1.87-4.17 4.17 0 .33.04.65.11.95A11.83 11.83 0 013 5.48c-.36.6-.56 1.3-.56 2.05 0 1.45.74 2.74 1.86 3.5a4.16 4.16 0 01-1.89-.52v.05c0 2.04 1.45 3.75 3.37 4.14a4.2 4.2 0 01-1.88.07c.53 1.66 2.08 2.87 3.91 2.9a8.3 8.3 0 01-5.16 1.78c-.34 0-.68-.02-1.02-.06C3 20.3 5.17 21 7.42 21c8.93 0 13.82-7.4 13.82-13.82 0-.21-.01-.43-.01-.64.95-.69 1.77-1.55 2.42-2.5zm-3.07 1.77c-.98-.67-2.1-.96-3.23-.96-1.15 0-2.26.31-3.26.94-1.01.63-1.86 1.48-2.49 2.49-.63 1-.94 2.1-.94 3.26 0 1.14.3 2.25.92 3.23.63 1.01 1.48 1.86 2.49 2.49 1 .63 2.11.94 3.26.94 1.15 0 2.26-.31 3.26-.94 1.01-.63 1.86-1.48 2.49-2.49.63-1 .94-2.1.94-3.26 0-1.14-.3-2.25-.92-3.23z" fill-rule="evenodd" clip-rule="evenodd"/>`;
                    case 'linkedin':
                        return `<path d="M19 0h-14c-2.76 0-5 2.24-5 5v14c0 2.76 2.24 5 5 5h14c2.76 0 5-2.24 5-5v-14c0-2.76-2.24-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.784 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.364-4-3.113-4 0v5.604h-3v-11h3v1.765c1.395-2.535 7-2.76 7 2.518v6.717z"/>`;
                    default:
                        return `<circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="2" fill="none"/><path d="M12 6v6l4 2" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>`; // Generic circle for others
                }
            }


            // Mock data for governance actions to simulate API response
            const mockGovernanceActions = [
                { txId: '28a99b422180816a7f833a69778a10bd86737526715f27668576409a7a7835dc', type: 'Info Action', metadata: { "674": { "msg": ["Poll: DRep Tooling Priorities"], "pollDetails": { "specVersion": "1.0", "type": "single-choice", "question": "Which DRep tooling area needs most focus?", "description": "This poll gauges sentiment on where to prioritize development for professional DRep tooling.", "options": ["Advanced Analytics", "Co-signer/Multi-sig Tools", "Communication Standards", "Delegation Management"], "maxSelections": 1, "eligibility": ["DRep"], "voteWeighting": "CredentialBased" }}}},
                { txId: 'a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2', type: 'Info Action', metadata: { "674": { "msg": ["Poll: Cardano Summit 2026"], "pollDetails": { "specVersion": "1.0", "type": "multi-select", "question": "Where should Cardano Summit be hosted in 2026?", "description": "Select your top 3 preferred continents. Results will guide the Cardano Foundation.", "options": ["Africa", "Asia", "Europe", "North America", "South America", "Australia"], "maxSelections": 3, "voteWeighting": "StakeBased" }}}},
                { txId: '11aa22bb33cc44dd55ee66ff77gg88hh99ii00jj11kk22ll33mm44nn55oo66pp', type: 'Info Action', metadata: { "674": { "msg": ["Community Poll: Next Hackathon Theme"], "pollDetails": { "specVersion": "1.0", "type": "single-choice", "question": "What should the theme of the next official Cardano Hackathon be?", "description": "This is a grassroots poll to measure community interest. Votes from formal governance roles (DReps, SPOs, CCs) will not be counted in the official tally.", "options": ["Gaming & Metaverse", "Sustainable DeFi", "Real-World Asset Tokenization", "Decentralized Identity"], "maxSelections": 1, "eligibility": ["Stakeholder"], "voteWeighting": "CredentialBased" }}}},
                { txId: 'f0e1d2c3b4a5f0e1d2c3b4a5f0e1d2c3b4a5f0e1d2c3b4a5f0e1d2c3b4a5f0e1', type: 'Info Action', metadata: { "674": { "msg": ["Poll: Treasury Grant Focus"], "pollDetails": { "specVersion": "1.0", "type": "multi-select", "question": "What should be the top 2 priorities for treasury grants?", "description": "Select up to two areas you believe are most critical for ecosystem growth via treasury funding. Open to DReps and SPOs.", "options": ["DeFi Development", "RealFi & Identity Solutions", "Developer Tooling", "Community & Education", "Marketing & Adoption"], "maxSelections": 2, "eligibility": ["DRep", "SPO"], "voteWeighting": "StakeBased" }}}},
                { 
                    txId: 'elec8d76a5b4c3d2e1f0elec8d76a5b4c3d2e1f0elec8d76a5b4c3d2e1f0elec', 
                    type: 'Info Action', 
                    metadata: { 
                        "674": { 
                            "msg": ["Election: Constitutional Committee Member Election 2025"], 
                            "pollDetails": { 
                                "specVersion": "1.1", // Updated to 1.1 for CIP compliance
                                "type": "multi-select", 
                                "question": "Cast your vote for the next Constitutional Committee Member(s):", 
                                "description": "This election aims to select new members for the Constitutional Committee. Each candidate brings unique skills and vision. Please review their profiles below before casting your vote(s). You can select between 1 and 4 candidates.",
                                "options": [ 
                                    "Candidate Alice Smith",
                                    "Consortium Innovate Collective",
                                    "Company BlockBuilders Inc.",
                                    "Candidate Jack Miller",
                                    "Company Catalyst Labs",
                                    "Consortium Global Alliance DAO",
                                    "Candidate Henry Wilson",
                                    "Company Decentralized Ventures",
                                    "Candidate Ivy Davis",
                                    "Candidate Bob Johnson"
                                ],
                                "maxSelections": 4, 
                                "eligibility": ["Stakeholder", "DRep", "SPO", "CC"], 
                                "voteWeighting": "StakeBased",
                                "candidates": [ 
                                    {
                                        "name": "Candidate Alice Smith",
                                        "type": "individual",
                                        "intro": "Dedicated to enhancing Cardano's smart contract security and dApp architecture. A proponent of community-driven development and open standards. Actively contributes to CIPs.",
                                        "profile": { 
                                            "bio": "Alice has spent nearly a decade in the blockchain space, focusing on Solidity audits and Plutus development. Her expertise lies in identifying and mitigating vulnerabilities in complex decentralized systems. She believes that robust security is paramount for ecosystem growth on Cardano. Her commitment to open source and collaborative initiatives makes her a strong advocate for technical excellence within the governance framework. She is passionate about ensuring the on-chain governance system is secure, transparent, and responsive to the needs of the community.",
                                            "experience": [
                                                "Lead Blockchain Security Engineer, DeFi Innovations (2022-Present): Spearheaded security audits for major DeFi protocols on Cardano, identifying and patching critical vulnerabilities.",
                                                "Senior Plutus Developer, Cardano Solutions (2018-2022): Developed and deployed numerous Plutus smart contracts for various dApps and infrastructure projects.",
                                                "Smart Contract Auditor, CryptoSafeguard (2016-2018): Conducted comprehensive security reviews of Ethereum smart contracts.",
                                                "Contributor to CIP-0001 (Smart Contract Standards): Played a key role in drafting and refining community improvement proposals related to smart contract best practices."
                                            ],
                                            "socialMedia": {
                                                "twitter": "https://twitter.com/Alice_Cardano",
                                                "linkedin": "https://linkedin.com/in/alicesmith_blockchain"
                                            }
                                        },
                                        "ccCredential": "cc_cold_alice_smith_hash_a1b2c3d4e5f67890"
                                    },
                                    {
                                        "name": "Consortium Innovate Collective",
                                        "type": "consortium",
                                        "intro": "A collective of leading blockchain innovators focused on accelerating Cardano's enterprise adoption through scalable and secure solutions.",
                                        "profile": {
                                            "bio": "Innovate Collective brings together diverse expertise to tackle complex challenges in the blockchain space. Their mission is to bridge the gap between traditional enterprise needs and decentralized technologies on Cardano, fostering a robust and compliant ecosystem. They have a proven record of delivering high-impact projects. They believe that collaboration across specialized entities is key to building comprehensive and resilient solutions.",
                                            "experience": [
                                                "Developed cross-chain atomic swaps for a major financial institution (2023)",
                                                "Launched a decentralized identity solution for healthcare providers (2022)",
                                                "Contributed to core Plutus development and performance optimizations (2021-Present)",
                                                "Successfully deployed a pilot supply chain tracking system using Cardano for a global logistics firm (2023-2024)."
                                            ],
                                            "socialMedia": {
                                                "twitter": "https://twitter.com/InnovateCollect",
                                                "linkedin": "https://linkedin.com/company/innovatecollective"
                                            },
                                            "members": [
                                                {"name": "John Doe", "role": "Lead Strategist", "bio": "Over 15 years in tech strategy and enterprise blockchain solutions."},
                                                {"name": "Jane Roe", "role": "Head of Engineering", "bio": "Expert in Plutus and Haskell, leading complex smart contract implementations."},
                                                {"name": "Peter Pan", "role": "Community & Ecosystem Lead", "bio": "Connects developers and businesses, fostering collaborative projects within Cardano."}
                                            ]
                                        },
                                        "ccCredential": "cc_cold_innovate_collective_hash_b2c3d4e5f67890a1"
                                    },
                                    {
                                        "name": "Company BlockBuilders Inc.",
                                        "type": "company",
                                        "intro": "Specializing in modular blockchain infrastructure and developer tools for the Cardano ecosystem. (Short Profile)",
                                        "profile": {
                                            "bio": "BlockBuilders Inc. is a lean but impactful company dedicated to providing essential building blocks for developers on Cardano. Their focus is on creating high-quality, open-source tools that streamline the development process and enhance network security. They aim to reduce complexity and accelerate innovation.",
                                            "experience": [
                                                "Released Cardano dApp scaffolding tool (2023)",
                                                "Developed open-source wallet connector library (2022)"
                                            ],
                                            "socialMedia": {
                                                "twitter": "https://twitter.com/BlockBuilders",
                                                "linkedin": "https://linkedin.com/company/blockbuilders-inc"
                                            }
                                        },
                                        "ccCredential": "cc_cold_blockbuilders_inc_hash_c3d4e5f67890a1b2"
                                    },
                                    {
                                        "name": "Candidate Jack Miller",
                                        "type": "individual",
                                        "intro": "A deep researcher into blockchain protocols and game theory. Focused on ensuring Cardano remains at the forefront of innovation, security, and efficiency. (Very Long Profile)",
                                        "profile": {
                                            "bio": "Jack is a highly respected theoretical computer scientist with a strong focus on decentralized systems and cryptographic research. His academic background, including a Ph.D. from MIT, provides a rigorous and analytical approach to evaluating and proposing improvements to Cardano's core protocols and economic models. He is dedicated to pushing the boundaries of what's possible on-chain, constantly seeking novel solutions to scalability, security, and decentralization challenges. His work often involves complex mathematical modeling and simulations to predict the long-term behavior of protocol changes. Jack believes that a deep understanding of foundational principles is crucial for sustainable and secure blockchain evolution. He is particularly interested in enhancing voting mechanisms and treasury management systems through advanced game theory applications. His recent work on verifiable delay functions could significantly impact future proof-of-stake systems. He is committed to fostering an environment of scientific rigor within the Cardano community.",
                                            "experience": [
                                                "Research Scientist, Distributed Ledger Lab (2022-Present): Led research on novel consensus algorithms and cryptographic primitives for next-generation blockchains.",
                                                "Ph.D. Candidate, Cryptography & Security (2018-2022): Developed new frameworks for secure multi-party computation and zero-knowledge proofs.",
                                                "Junior Researcher, Algorithmic Solutions (2017-2018): Contributed to optimization algorithms for distributed database systems.",
                                                "Published over 10 peer-reviewed papers in top-tier cryptography and blockchain conferences, including Eurocrypt and Crypto.",
                                                "Keynote speaker at multiple international blockchain summits, including the Cardano Summit and EthDenver.",
                                                "Recipient of the Blockchain Innovator Award (2023) for his work on decentralized oracle networks."
                                            ],
                                            "socialMedia": {
                                                "twitter": "https://twitter.com/Jack_Research",
                                                "linkedin": "https://linkedin.com/in/jackmiller_research"
                                            }
                                        },
                                        "ccCredential": "cc_cold_jack_miller_hash_d4e5f67890a1b2c3"
                                    },
                                    {
                                        "name": "Company Catalyst Labs",
                                        "type": "company",
                                        "intro": "Pioneering decentralized funding solutions and community engagement platforms for the Cardano ecosystem. (Medium Profile)",
                                        "profile": {
                                            "bio": "Catalyst Labs is at the forefront of innovation within Cardano's Project Catalyst, focusing on building tools and platforms that empower the community to propose, fund, and execute impactful projects. Their team comprises seasoned developers, UX/UI specialists, and community managers dedicated to improving the governance experience and resource allocation. They have been instrumental in developing voting clients, proposal review systems, and analytics dashboards that enhance transparency and participation, making Catalyst more accessible and efficient for everyone.",
                                            "experience": [
                                                "Developed and maintained the official Catalyst Voting Client for desktop and mobile (2021-Present)",
                                                "Implemented a multi-signature treasury management system for funded projects (2022)",
                                                "Hosted numerous community workshops and hackathons focused on governance participation (2021-Present)",
                                                "Awarded 'Most Impactful Contributor' by the Project Catalyst community for three consecutive years for their consistent delivery and support."
                                            ],
                                            "socialMedia": {
                                                "twitter": "https://twitter.com/CatalystLabs",
                                                "linkedin": "https://linkedin.com/company/catalyst-labs"
                                            }
                                        },
                                        "ccCredential": "cc_cold_catalyst_labs_hash_e5f67890a1b2c3d4"
                                    },
                                    {
                                        "name": "Consortium Global Alliance DAO",
                                        "type": "consortium",
                                        "intro": "A powerful global alliance of blockchain organizations, academic institutions, and industry leaders driving large-scale adoption initiatives.",
                                        "profile": {
                                            "bio": "The Global Alliance DAO is a formidable collective focused on securing major partnerships, driving policy changes, and fostering inter-chain collaboration for the broader blockchain space, with a significant emphasis on Cardano. Their diverse membership allows them to influence various sectors, from finance and supply chain to digital identity and public infrastructure. They operate with a clear mandate to accelerate the real-world utility of decentralized technologies through strategic alliances and large-scale deployments, working tirelessly to break down barriers to adoption. Their initiatives often involve complex legal frameworks, international cooperation, and integration with existing legacy systems, requiring a high degree of coordination and expertise from their numerous members.",
                                            "experience": [
                                                "Signed MoU with a G7 nation for blockchain-based supply chain pilot (2024)",
                                                "Established a global academic research grant program for decentralized technologies (2023)",
                                                "Successfully lobbied for favorable blockchain legislation in multiple jurisdictions (2022-Present)",
                                                "Co-hosted the annual 'Future of Decentralization' summit, attracting global leaders and shaping industry discourse."
                                            ],
                                            "socialMedia": {
                                                "twitter": "https://twitter.com/GlobalAlliance",
                                                "linkedin": "https://linkedin.com/company/global-alliance-dao"
                                            },
                                            "members": [
                                                {"name": "Dr. Anya Sharma", "role": "Chairperson, Policy & Strategy", "bio": "Former UN advisor on digital governance, specializing in international blockchain policy."},
                                                {"name": "Markus Thiel", "role": "Lead, Enterprise Solutions", "bio": "Ex-CTO of a Fortune 500 company, driving blockchain integration for large enterprises."},
                                                {"name": "Sofia Rodriguez", "role": "Head of Research & Development", "bio": "Authored multiple papers on scalable distributed systems and zero-knowledge proofs."},
                                                {"name": "Kenji Tanaka", "role": "APAC Regional Director", "bio": "Expert in Asian market penetration and regulatory compliance for blockchain."},
                                                {"name": "Lena Petrova", "role": "Legal & Compliance Lead", "bio": "Specializes in global legal frameworks for crypto assets and DAOs."},
                                                {"name": "Carlos Gomez", "role": "Partnerships & Outreach", "bio": "Focuses on forging strategic alliances with governments, NGOs, and corporations."},
                                                {"name": "Sarah Chen", "role": "Communications Director", "bio": "Manages global communication strategies and public relations for the alliance."}
                                            ]
                                        },
                                        "ccCredential": "cc_cold_global_alliance_dao_hash_f67890a1b2c3d4e5"
                                    },
                                    {
                                        "name": "Candidate Henry Wilson",
                                        "type": "individual",
                                        "intro": "A prolific developer and open-source contributor. Focuses on improving developer tooling and infrastructure to make it easier for new builders on Cardano. (Medium Profile)",
                                        "profile": {
                                            "bio": "Henry is a full-time open-source contributor to various Cardano-related projects, including tooling, SDKs, and documentation. He believes that a thriving developer ecosystem is key to Cardano's long-term success and is committed to fostering an environment where innovation can flourish by providing accessible and robust development resources. His contributions span across front-end libraries, backend APIs, and smart contract frameworks, directly enabling developers to build faster and more securely.",
                                            "experience": [
                                                "Core Developer, Cardano Tooling Initiative (2022-Present): Actively developing and maintaining core developer tools for the Cardano ecosystem.",
                                                "Lead Software Engineer, Developer Solutions Inc. (2019-2022): Led a team in building open-source developer frameworks for Web3 applications.",
                                                "Full Stack Developer, Web3 Labs (2017-2019): Contributed to decentralized application development on various blockchain platforms."
                                            ],
                                            "socialMedia": {
                                                "twitter": "https://twitter.com/Henry_Dev",
                                                "linkedin": "https://linkedin.com/in/henrywilson_dev"
                                            }
                                        },
                                        "ccCredential": "cc_cold_henry_wilson_hash_890a1b2c3d4e5f67"
                                    },
                                    {
                                        "name": "Company Decentralized Ventures",
                                        "type": "company",
                                        "intro": "An investment firm accelerating the growth of promising decentralized projects on Cardano and beyond. (Long Profile)",
                                        "profile": {
                                            "bio": "Decentralized Ventures is a leading venture capital firm exclusively focused on funding and nurturing innovative blockchain projects within the Cardano ecosystem. With a team of experienced venture capitalists, blockchain strategists, and technical advisors, they provide not just capital but also invaluable mentorship, extensive network access, and comprehensive strategic guidance to their portfolio companies. Their mission is to identify, empower, and scale the next generation of decentralized applications and infrastructure that will drive mass adoption and unlock new utilities on Cardano. They are committed to sustainable growth and fostering a diverse and robust ecosystem, contributing significantly to the overall health and expansion of the Cardano network.",
                                            "experience": [
                                                "Led seed rounds for 5+ successful Cardano DApps (2022-Present), facilitating their initial growth and market entry.",
                                                "Mentored 10+ startups through accelerator programs (2021-Present), providing hands-on support for product development and business strategy.",
                                                "Published comprehensive market research reports on DeFi and NFT trends on Cardano (2023), guiding ecosystem development.",
                                                "Key strategic partner for new project launches, providing go-to-market support and industry connections."
                                            ],
                                            "socialMedia": {
                                                "twitter": "https://twitter.com/DecentralizedVC",
                                                "linkedin": "https://linkedin.com/company/decentralized-ventures"
                                            }
                                        },
                                        "ccCredential": "cc_cold_decentralized_ventures_hash_90a1b2c3d4e5f678"
                                    },
                                    {
                                        "name": "Candidate Ivy Davis",
                                        "type": "individual",
                                        "intro": "A marketing and communications specialist committed to increasing Cardano's global awareness and fostering positive public perception. (Medium Profile)",
                                        "profile": {
                                            "bio": "Ivy has a strong background in brand strategy and public relations within the technology sector, with a focus on blockchain and decentralized technologies. She has successfully launched several major products and campaigns, focusing on clear, engaging, and impactful communication strategies. Her mission is to amplify Cardano's message, enhance its public image, and reach new audiences worldwide through effective storytelling and strategic partnerships. She believes in transparent communication as a cornerstone of a healthy decentralized ecosystem.",
                                            "experience": [
                                                "Head of Marketing, Blockchain Innovations (2021-Present): Responsible for global marketing strategy and execution for a leading blockchain firm.",
                                                "Senior PR Manager, Tech Communications Group (2018-2021): Managed public relations for high-growth tech startups, securing significant media coverage.",
                                                "Content Strategist, Digital Marketing Agency (2016-2018): Developed content strategies for diverse clients, focusing on digital engagement and brand building."
                                            ],
                                            "socialMedia": {
                                                "twitter": "https://twitter.com/Ivy_Comms",
                                                "linkedin": "https://linkedin.com/in/ivydavis_marketing"
                                            }
                                        },
                                        "ccCredential": "cc_cold_ivy_davis_hash_0a1b2c3d4e5f6789"
                                    },
                                    {
                                        "name": "Candidate Bob Johnson",
                                        "type": "individual",
                                        "intro": "Community organizer and educator passionate about onboarding new users. (Bare Minimum Profile)",
                                        "profile": {
                                            "bio": "Bob is a dedicated community advocate. He simplifies blockchain concepts for newcomers.",
                                            "experience": [
                                                "Community Lead, Ada Builders (2023-Present)"
                                            ],
                                            "socialMedia": {
                                                "twitter": "https://twitter.com/Bob_Community",
                                                "linkedin": "https://linkedin.com/in/bobjohnson_community"
                                            }
                                        },
                                        "ccCredential": "cc_cold_bob_johnson_hash_1b2c3d4e5f67890a"
                                    }
                                ]
                            }
                        }
                    }
                },
                { txId: 'c1d2e3f4a5b6c1d2e3f4a5b6c1d2e3f4a5b6c1d2e3f4a5b6c1d2e3f4a5b6c1d2', type: 'Hard-Fork Initiation', metadata: null },
                { txId: 'b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3', type: 'No Confidence', metadata: { "674": { "msg": ["No confidence in current CC members"] }}},
                { txId: 'd3e4f5a6b1c2d3e4f5a6b1c2d3e4f5a6b1c2d3e4f5a6b1c2d3e4f5a6b1c2d3e4', type: 'Update to the Constitution', metadata: null },
                { txId: 'e4f5a6b1c2d3e4f5a6b1c2d3e4f5a6b1c2d3e4f5a6b1c2d3e4f5a6b1c2d3e4f5', type: 'Treasury Withdrawal', metadata: { "674": { "msg": ["Funding for Project Catalyst Round 15"] }}},
            ];

            let selectedOptions = []; // Stores selected poll options
            let isWalletConnected = false; // Tracks wallet connection status
            let currentAction = null; // Stores the currently selected governance action
            let sortableInstance = null; // Sortable.js instance for multi-select polls
            let currentUserRole = 'Stakeholder'; // Default user role
            let expandedCandidate = null; // Stores the name of the currently expanded candidate profile

            // Object to store references to frequently used DOM elements
            const DOM = {
                actionsList: document.getElementById('governance-actions-list'),
                detailsPanel: document.getElementById('details-panel'),
                connectWalletBtn: document.getElementById('connect-wallet-btn'),
                roleSelector: document.getElementById('role-selector'),
                feedbackModal: document.getElementById('custom-feedback-modal'),
                modalMessage: document.getElementById('modal-feedback-message'),
            };
            
            /**
             * Copies text to the clipboard.
             * @param {string} text - The text to copy.
             * @param {HTMLElement} button - The button element that triggered the copy.
             */
            window.copyToClipboard = (text, button) => {
                const textArea = document.createElement('textarea');
                textArea.value = text;
                document.body.appendChild(textArea);
                textArea.style.position = 'fixed'; // Prevents scrolling to the textarea
                textArea.style.left = '-9999px';    // Hides the textarea off-screen
                textArea.select();
                try {
                    document.execCommand('copy'); // Deprecated but widely supported for iframes
                    const originalText = button.textContent;
                    button.textContent = 'Copied!';
                    setTimeout(() => { button.textContent = originalText; }, 2000); // Revert button text after 2 seconds
                } catch (err) {
                    console.error('Failed to copy text: ', err);
                }
                document.body.removeChild(textArea);
            };

            /**
             * Initializes the application by rendering the actions list and welcome message,
             * and attaching event listeners.
             */
            function init() {
                renderActionsList();
                showWelcomeMessage();
                DOM.connectWalletBtn.addEventListener('click', handleWalletConnect);
                DOM.roleSelector.addEventListener('change', handleRoleChange);
            }

            /**
             * Renders the list of governance actions in the left panel.
             */
            function renderActionsList() {
                DOM.actionsList.innerHTML = ''; // Clear existing list
                mockGovernanceActions.forEach(action => {
                    // Determine the title of the action (poll question or action type/message)
                    const pollDetails = action.metadata?.['674']?.pollDetails;
                    const title = pollDetails ? pollDetails.question : action.metadata?.['674']?.msg?.[0] || action.type;
                    
                    const actionEl = document.createElement('div');
                    actionEl.className = 'bg-panel-item p-4 rounded-lg border-2 border-transparent action-item-hover cursor-pointer transition';
                    actionEl.dataset.txId = action.txId; // Store transaction ID for easy lookup
                    actionEl.innerHTML = `
                        <div class="flex justify-between items-start">
                            <h3 class="font-semibold text-primary pr-2">${title}</h3>
                            ${pollDetails ? '<span class="text-xs bg-purple-600 text-white px-2 py-1 rounded-full whitespace-nowrap">Poll</span>' : ''}
                        </div>
                        <p class="text-sm text-tertiary mt-2">Type: ${action.type}</p>
                    `;
                    // Add click listener to show details when an action is selected
                    actionEl.addEventListener('click', () => handleActionSelect(action.txId));
                    DOM.actionsList.appendChild(actionEl);
                });
            }
            
            /**
             * Displays a welcome message in the details panel.
             */
            function showWelcomeMessage() {
                DOM.detailsPanel.innerHTML = `
                    <div class="text-center flex flex-col items-center justify-center h-full min-h-[50vh]">
                        <img src="munin.png" alt="Munin Logo" class="w-60 h-60 mb-4 rounded-lg">
                        <h3 class="font-viking text-4xl font-normal text-primary">Welcome to Munin</h3>
                        <p class="text-tertiary mt-2 max-w-lg">Select a governance action from the list on the left to view its details or participate in a poll.</p>
                    </div>`;
            }

            /**
             * Renders the details for a non-poll governance action.
             * @param {object} action - The governance action object.
             */
            function renderNonPollDetails(action) {
                const title = action.metadata?.['674']?.msg?.[0] || action.type;
                DOM.detailsPanel.innerHTML = `
                    <h2 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-pink-600 mb-2">${title}</h2>
                    <p class="text-tertiary mb-6">Type: ${action.type}</p>
                    <div class="bg-panel-item p-4 rounded-lg">
                        <p class="text-secondary font-semibold">Transaction ID:</p>
                        <p class="text-sm text-tertiary break-all">${action.txId}</p>
                        <p class="text-secondary font-semibold mt-4">Details:</p>
                        <p class="text-tertiary">This is a standard governance action. Voting is handled by DReps, SPOs, and CC Members through dedicated governance interfaces.</p>
                    </div>
                `;
            }

            /**
             * Renders the voting UI for non-poll governance actions (for DRep, SPO, CC roles).
             * @param {object} action - The governance action object.
             */
            function renderNonPollVotingUI(action) {
                const title = action.metadata?.['674']?.msg?.[0] || action.type;
                // Adjust button text based on current user role for CC members
                let voteButtonsHtml = (currentUserRole === 'CC') ? `
                    <button data-vote="yes" class="w-full text-white font-bold py-3 px-4 rounded-lg transition duration-300 bg-green-600 hover:bg-green-700 shadow-lg shadow-green-900/40">Vote Constitutional</button>
                    <button data-vote="no" class="w-full text-white font-bold py-3 px-4 rounded-lg transition duration-300 bg-red-600 hover:bg-red-700 shadow-lg shadow-red-900/40">Vote Unconstitutional</button>
                    <button data-vote="abstain" class="w-full text-white font-bold py-3 px-4 rounded-lg transition duration-300 bg-gray-600 hover:bg-gray-700 shadow-lg shadow-gray-900/40">Abstain</button>`
                    : `
                    <button data-vote="yes" class="w-full text-white font-bold py-3 px-4 rounded-lg transition duration-300 bg-green-600 hover:bg-green-700 shadow-lg shadow-green-900/40">Vote Yes</button>
                    <button data-vote="no" class="w-full text-white font-bold py-3 px-4 rounded-lg transition duration-300 bg-red-600 hover:bg-red-700 shadow-lg shadow-red-900/40">Vote No</button>
                    <button data-vote="abstain" class="w-full text-white font-bold py-3 px-4 rounded-lg transition duration-300 bg-gray-600 hover:bg-gray-700 shadow-lg shadow-gray-900/40">Vote Abstain</button>`;

                DOM.detailsPanel.innerHTML = `
                    <h2 class="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-pink-600 mb-2">${title}</h2>
                    <p class="text-tertiary mb-6">Type: ${action.type}</p>
                    <div class="bg-panel-item p-4 rounded-lg mb-6">
                        <p class="text-secondary font-semibold">Transaction ID:</p>
                        <p class="text-sm text-tertiary break-all">${action.txId}</p>
                    </div>
                    <h3 class="text-xl font-semibold text-primary mb-4">Cast Your Governance Vote as a ${currentUserRole}</h3>
                    <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4 mb-6" id="gov-vote-buttons">${voteButtonsHtml}</div>
                    <div id="manual-submission-details" class="hidden mt-6 space-y-4"></div>
                `;
                // Add event listener to the vote buttons container using event delegation
                DOM.detailsPanel.querySelector('#gov-vote-buttons').addEventListener('click', (e) => {
                    const button = e.target.closest('button');
                    if(button) { // Ensure a button was clicked
                        renderGovCliCommand(action, button.dataset.vote);
                    }
                });
            }

            /**
             * Renders the Cardano CLI command for non-poll governance actions.
             * @param {object} action - The governance action object.
             * @param {string} vote - The vote chosen ('yes', 'no', 'abstain').
             */
            function renderGovCliCommand(action, vote) {
                const manualDetailsEl = DOM.detailsPanel.querySelector('#manual-submission-details');
                // Determine the correct role flag for the CLI command
                const roleFlag = {
                    'DRep': '--drep-verification-key-file path/to/drep.vkey',
                    'SPO': '--cold-verification-key-file path/to/pool.vkey',
                    'CC': '--cc-hot-verification-key-file path/to/cc.vkey'
                }[currentUserRole];
                // Determine the correct vote flag for the CLI command
                const voteFlag = {
                    'yes': '--vote-yes',
                    'no': '--vote-no',
                    'abstain': '--abstain'
                }[vote];

                // Construct the CLI command string
                const cliCommand = `cardano-cli governance action vote create \\
    ${voteFlag} \\
    --governance-action-tx-id ${action.txId} \\
    --governance-action-index 0 \\
    ${roleFlag} \\
    --out-file ${currentUserRole.toLowerCase()}-gov-vote.json`;

                manualDetailsEl.innerHTML = `
                    <div class="border-t border-theme pt-6">
                        <h3 class="text-xl font-semibold text-purple-500">Manual Submission Guide for a ${currentUserRole}</h3>
                        <p class="text-tertiary mt-2">Use this command to create your vote file. After creating the file, you must include it in a transaction to submit your vote.</p>
                        <div class="relative bg-cli-code p-4 rounded-lg mt-4">
                            <!-- Copy button for the CLI command -->
                            <button onclick="copyToClipboard(this.nextElementSibling.textContent, this)" class="absolute top-2 right-2 bg-gray-400 dark:bg-gray-600 hover:bg-gray-500 dark:hover:bg-gray-500 text-xs px-2 py-1 rounded">Copy</button>
                            <pre class="text-sm text-cli-code whitespace-pre-wrap break-all">${cliCommand}</pre>
                        </div>
                    </div>
                `;
                manualDetailsEl.classList.remove('hidden'); // Show the manual submission details
                
                // Add highlight ring to the selected vote button
                DOM.detailsPanel.querySelectorAll('#gov-vote-buttons button').forEach(button => {
                    button.classList.remove('ring-2', 'ring-offset-2', 'ring-offset-theme', 'ring-purple-500');
                    if (button.dataset.vote === vote) {
                        button.classList.add('ring-2', 'ring-offset-2', 'ring-offset-theme', 'ring-purple-500');
                    }
                });
            }
            
            /**
             * Generates a message regarding poll eligibility and vote weighting.
             * @param {Array<string>} eligibility - Array of roles eligible to vote.
             * @param {string} voteWeighting - The method of vote weighting (e.g., 'StakeBased', 'CredentialBased').
             * @returns {object} An object containing the message, a boolean indicating if the current user is permitted, and the CSS class name.
             */
            function getEligibilityMessage(eligibility, voteWeighting) {
                if (!eligibility || eligibility.length === 0) {
                    return { message: `This poll is open to all Ada holders. Votes are **${voteWeighting}**.`, permitted: true, className: 'alert-permitted' };
                }

                const isStakeholderPoll = eligibility.includes('Stakeholder');
                let isPermitted = eligibility.includes(currentUserRole);
                let message = `This poll is restricted to: **${eligibility.join(', ')}**. Votes are **${voteWeighting}**.`;

                // Special handling for Stakeholder-only polls
                if (isStakeholderPoll && eligibility.length === 1) {
                    isPermitted = currentUserRole === 'Stakeholder';
                    message = `This is a community poll for all **Stakeholders**. Votes from registered DReps, SPOs, and CCs will not be counted in the official tally. Vote weighting is **${voteWeighting}**.`;
                }

                const roleName = currentUserRole;
                if (isPermitted) {
                    message += ` As a **${roleName}**, your vote will be counted.`;
                } else {
                    message += ` As a **${roleName}**, your vote will NOT be counted, but you can still submit it to voice your opinion.`;
                }
                
                return { message, permitted: isPermitted, className: isPermitted ? 'alert-permitted' : 'alert-not-permitted' };
            }

            /**
             * Renders the details and voting UI for a poll governance action.
             * @param {object} action - The governance action object (which is a poll).
             */
            function renderPoll(action) {
                currentAction = action; // Set the current action to the selected poll
                const pollDetails = action.metadata['674'].pollDetails;
                selectedOptions = []; // Reset selected options for a new poll
                expandedCandidate = null; // Reset expanded candidate on new poll render
                
                const { question, description, options, type, maxSelections, eligibility, voteWeighting, candidates } = pollDetails;
                
                // Get eligibility message and format it for display
                const eligibilityInfo = getEligibilityMessage(eligibility, voteWeighting || 'StakeBased');
                const eligibilityMessageHtml = `<div class="alert-box ${eligibilityInfo.className}">${eligibilityInfo.message.replace(/\*\*(.*?)\*\*/g, '<strong class="font-semibold text-current">$1</strong>')}</div>`;
                
                // Generate HTML for poll options (candidate boxes for election)
                const optionsHtml = options.map(optName => {
                    const candidate = candidates ? candidates.find(c => c.name === optName) : null;
                    const intro = candidate ? candidate.intro : ''; 
                    const cleanedName = optName.replace(/\s+/g, '-').replace(/[^\w-]/g, ''); // For ID safety: remove non-alphanumeric except hyphen
                    const isSelected = selectedOptions.includes(optName);

                    let profileDetailsHtml = '';
                    if (candidate) {
                        let membersHtml = '';
                        if (candidate.type === 'consortium' && candidate.profile.members) {
                            membersHtml = `<h5 class="font-semibold text-primary mb-1 mt-3">Members:</h5>
                                <ul class="list-disc list-inside text-secondary text-sm mb-2 pl-4">
                                    ${candidate.profile.members.map(member => `<li><strong>${member.name}</strong> (${member.role}): ${member.bio}</li>`).join('')}
                                </ul>`;
                        }

                        profileDetailsHtml = `
                            <div id="profile-${cleanedName}-details" class="profile-details-section hidden mt-4 pt-4 border-t border-theme">
                                <h5 class="font-semibold text-primary mb-1">Bio:</h5>
                                <p class="text-secondary text-sm mb-2">${candidate.profile.bio}</p>
                                <h5 class="font-semibold text-primary mb-1">Experience:</h5>
                                <ul class="list-disc list-inside text-secondary text-sm mb-2 pl-4">
                                    ${candidate.profile.experience.map(exp => `<li>${exp}</li>`).join('')}
                                </ul>
                                ${membersHtml} <!-- Insert members HTML here -->
                                <h5 class="font-semibold text-primary mb-1">Social Media:</h5>
                                <div class="flex flex-wrap gap-2 text-sm mb-4">
                                    ${Object.entries(candidate.profile.socialMedia).map(([platform, link]) => `
                                        <a href="${link}" target="_blank" class="text-purple-500 hover:underline flex items-center">
                                            <svg class="w-4 h-4 mr-1" fill="currentColor" viewBox="0 0 24 24">${getSocialIcon(platform)}</svg>
                                            ${platform.charAt(0).toUpperCase() + platform.slice(1)}
                                        </a>
                                    `).join('')}
                                </div>
                                <div class="bg-cli-code p-3 rounded-md text-sm text-cli-code break-all relative mb-4">
                                    <span class="font-semibold text-primary">CC Cold Credential:</span> ${candidate.ccCredential}
                                    <button onclick="copyToClipboard('${candidate.ccCredential}', this)" class="absolute top-2 right-2 bg-gray-400 dark:bg-gray-600 hover:bg-gray-500 dark:hover:bg-gray-500 text-xs px-2 py-1 rounded">Copy</button>
                                </div>
                                <button class="vote-button w-full ${isSelected ? 'bg-indigo-600 hover:bg-indigo-700' : 'bg-purple-600 hover:bg-purple-700'} text-white font-bold py-2 px-4 rounded-lg transition duration-300" data-candidate-name="${optName}">
                                    ${isSelected ? 'Voted!' : 'Vote for this candidate'}
                                </button>
                            </div>
                        `;
                    }

                    return `
                        <div class="candidate-box bg-panel-item p-3 rounded-lg hover:border-purple-500 transition-colors duration-200" data-candidate-name="${optName}">
                            <div class="flex items-center">
                                <span class="text-lg text-primary font-semibold">${optName}</span>
                                <span class="voted-indicator ml-2 text-green-500 ${isSelected ? '' : 'hidden'}">✔</span>
                            </div>
                            <p class="text-sm text-tertiary mt-1 max-w-full overflow-hidden text-ellipsis">${intro.substring(0, 300)}</p>
                            ${profileDetailsHtml}
                        </div>
                    `;
                }).join('');

                // Render the poll details to the details panel
                DOM.detailsPanel.innerHTML = `
                    <h2 class="text-3xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-500 to-pink-600 mb-2">${question}</h2>
                    <p class="text-tertiary mb-4">${description}</p>
                    ${eligibilityMessageHtml}
                    <div id="poll-options-container" class="space-y-3 mb-6">${optionsHtml}</div>
                    <!-- Ranked selection list for multi-select polls -->
                    ${type === 'multi-select' ? `<div class="mb-6"><h3 class="text-lg font-medium text-primary mb-2">Your Ranked Selection (Top to Bottom)</h3><ul id="selected-options-list" class="bg-panel-item p-3 rounded-lg min-h-[50px]"><li class="text-tertiary">Select up to ${maxSelections} options to rank them here.</li></ul></div>` : ''}
                    <div id="selection-feedback" class="text-sm text-yellow-600 dark:text-yellow-400 mb-4 hidden"></div>
                    <div id="submission-container" class="hidden">
                        <h3 class="text-lg font-medium text-primary mb-3">Submit Your Vote</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <button id="submit-wallet-btn" class="w-full bg-teal-600 hover:bg-teal-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300 disabled:bg-gray-500 dark:disabled:bg-gray-600 disabled:cursor-not-allowed flex items-center justify-center shadow-lg shadow-teal-900/40">Submit with Wallet</button>
                            <button id="manual-submit-btn" class="w-full bg-gray-600 hover:bg-gray-700 text-white font-bold py-3 px-4 rounded-lg transition duration-300">Manual / CLI Submission</button>
                        </div>
                        <div id="submission-status" class="text-center mt-4"></div>
                    </div>
                    <div id="manual-submission-details" class="hidden mt-6 space-y-4"></div>
                    <div id="results-container" class="mt-8 hidden"></div>
                `;

                // Add event listeners for expanding/collapsing profiles and for voting buttons
                DOM.detailsPanel.querySelectorAll('.candidate-box').forEach(box => {
                    box.addEventListener('click', toggleCandidateProfile);
                });
                // Event listener for the vote buttons (delegated to the container)
                // This ensures that vote buttons created dynamically are also handled.
                DOM.detailsPanel.addEventListener('click', handleVoteClick);

                renderRankedList(); // Initial render of ranked list
                updateSubmissionUI(); // Initial update of submission buttons
            }
            
            /**
             * Renders the ranked list of selected options for multi-select polls using Sortable.js.
             */
            function renderRankedList() {
                const listEl = DOM.detailsPanel.querySelector('#selected-options-list');
                if (!listEl) return; // Exit if not a multi-select poll

                const maxSelections = currentAction.metadata['674'].pollDetails.maxSelections;

                // Display placeholder if no options are selected
                if (selectedOptions.length === 0) {
                    listEl.innerHTML = `<li class="text-tertiary">Select up to ${maxSelections} options to rank them here.</li>`;
                    return;
                }

                listEl.innerHTML = ''; // Clear current list
                selectedOptions.forEach((option, index) => {
                    const li = document.createElement('li');
                    // Display option with its rank
                    li.innerHTML = `<span class="font-bold mr-2 text-purple-600 dark:text-purple-300">${index + 1}.</span> ${option}`;
                    li.className = 'bg-purple-200 dark:bg-purple-600/50 text-purple-900 dark:text-white p-2 rounded-md cursor-move';
                    li.dataset.id = option; // Store original option value for reordering
                    listEl.appendChild(li);
                });

                // Initialize or re-initialize Sortable.js
                if (sortableInstance) {
                    sortableInstance.destroy(); // Destroy previous instance if it exists
                }
                sortableInstance = new Sortable(listEl, {
                    animation: 150,
                    ghostClass: 'sortable-ghost', // Class for the ghost element
                    onEnd: (evt) => {
                        // Update selectedOptions array after drag-and-drop
                        selectedOptions = Array.from(listEl.children).map(item => item.dataset.id.replace(/&amp;/g, '&')); // Decode HTML entities
                        renderRankedList(); // Re-render to ensure correct state and re-bind Sortable
                    }
                });
            }

            /**
             * Renders the Cardano CLI command for poll submission.
             */
            function renderManualSubmission() {
                const manualDetailsEl = DOM.detailsPanel.querySelector('#manual-submission-details');
                if (!manualDetailsEl) return;

                // Construct metadata for the poll response
                const metadata = { "674": { "msg": [`Response to poll: ${currentAction.metadata['674'].pollDetails.question}`], "voteFor": { "actionTxId": currentAction.txId, "selection": selectedOptions }}};
                const metadataString = JSON.stringify(metadata);

                let cliCommand;
                // Different CLI commands for Stakeholders vs. formal governance roles
                if (currentUserRole === 'Stakeholder') {
                    cliCommand = `cardano-cli transaction build \\
    # Replace with --mainnet for main network
    --testnet \\
    # Replace with your wallet's UTXO
    --tx-in <Your-UTXO> \\
    # Replace with your wallet's address
    --tx-out <Your-Address>+1000000 \\
    # Replace with your wallet's change address
    --change-address <Your-Address> \\
    # The poll vote metadata
    --metadata-json-string '${metadataString}' \\
    --out-file poll-vote.txbody`;
                } else {
                    const roleFlag = {
                        'DRep': '--drep-verification-key-file path/to/drep.vkey',
                        'SPO': '--cold-verification-key-file path/to/pool.vkey',
                        'CC': '--cc-hot-verification-key-file path/to/cc.vkey'
                    }[currentUserRole];
                    cliCommand = `cardano-cli governance action vote create \\
    # Recommended vote for Info Action polls
    --abstain \\
    --governance-action-tx-id ${currentAction.txId} \\
    --governance-action-index 0 \\
    ${roleFlag} \\
    --out-file ${currentUserRole.toLowerCase()}-poll-vote.json \\
    # Poll response attached as metadata
    --metadata-json-string '${metadataString}'`;
                }

                manualDetailsEl.innerHTML = `
                    <div class="border-t border-theme pt-6">
                        <h3 class="text-xl font-semibold text-purple-600 dark:text-purple-400">Manual Submission Guide for a ${currentUserRole}</h3>
                        <p class="text-tertiary mt-2">Use this self-contained command to cast your vote. Replace placeholder paths with your own.</p>
                        <div class="relative bg-cli-code p-4 rounded-lg mt-4">
                            <!-- Copy button for the CLI command -->
                            <button onclick="copyToClipboard(this.nextElementSibling.textContent, this)" class="absolute top-2 right-2 bg-gray-400 dark:bg-gray-600 hover:bg-gray-500 dark:hover:bg-gray-500 text-xs px-2 py-1 rounded">Copy</button>
                            <pre class="text-sm text-cli-code whitespace-pre-wrap break-all">${cliCommand}</pre>
                        </div>
                        <p class="text-tertiary mt-2 text-sm">${currentUserRole === 'Stakeholder' ? 'After building, sign and submit the transaction.' : 'This creates a vote body file, which you then include in a transaction build.'}</p>
                    </div>
                `;
                manualDetailsEl.classList.remove('hidden'); // Show the manual submission details section
            }

            /**
             * Handles the selection of a governance action from the list.
             * Renders either a poll or a non-poll action details.
             * @param {string} txId - The transaction ID of the selected action.
             */
            function handleActionSelect(txId) {
                // Remove highlight from all actions
                document.querySelectorAll('#governance-actions-list > div').forEach(el => {
                    el.classList.remove('highlight-border', 'border-2');
                    el.classList.add('border-transparent');
                    if (el.dataset.txId === txId) {
                        el.classList.remove('border-transparent');
                        el.classList.add('highlight-border', 'border-2'); // Add highlight to selected action
                    }
                });
                
                // Find the selected action from mock data
                currentAction = mockGovernanceActions.find(a => a.txId === txId);
                const pollDetails = currentAction.metadata?.['674']?.pollDetails;

                // Reset expandedCandidate when a new action is selected
                expandedCandidate = null;

                // Render based on whether it's a poll or a regular governance action
                if (pollDetails) {
                    renderPoll(currentAction);
                } else if (['DRep', 'SPO', 'CC'].includes(currentUserRole)) {
                    // Show voting UI for formal governance roles on non-poll actions
                    renderNonPollVotingUI(currentAction);
                } else {
                    // Show basic details for stakeholders on non-poll actions
                    renderNonPollDetails(currentAction);
                }
            }

            /**
             * Simulates wallet connection.
             */
            function handleWalletConnect() {
                if (isWalletConnected) return; // Prevent connecting multiple times
                isWalletConnected = true;
                DOM.connectWalletBtn.classList.replace('bg-purple-600', 'bg-teal-600');
                DOM.connectWalletBtn.classList.replace('hover:bg-purple-700', 'hover:bg-teal-700');
                DOM.connectWalletBtn.innerHTML = `<span>Connected: addr1qy...a7p</span>`; // Display a mock connected address
                updateSubmissionUI(); // Update UI after wallet connection
            }

            /**
             * Handles change in user role selection.
             * Re-renders the current action's details to reflect role-based UI.
             * @param {Event} e - The change event.
             */
            function handleRoleChange(e) {
                currentUserRole = e.target.value; // Update current user role
                if (currentAction) {
                    // Re-render the current action to apply role-specific logic
                    const pollDetails = currentAction.metadata?.['674']?.pollDetails;
                    if (pollDetails) {
                        renderPoll(currentAction);
                    } else if (['DRep', 'SPO', 'CC'].includes(currentUserRole)) {
                        renderNonPollVotingUI(currentAction);
                    } else {
                        renderNonPollDetails(currentAction);
                    }
                }
            }

            /**
             * Toggles the visibility of a candidate's full profile.
             * Only one profile can be expanded at a time.
             * @param {Event} e - The click event.
             */
            function toggleCandidateProfile(e) {
                // Ensure the click was not on a vote button or copy button inside the profile
                if (e.target.closest('.vote-button') || e.target.closest('button.absolute')) { // Adjusted to match copy button
                    return;
                }

                const clickedBox = e.currentTarget; // The .candidate-box div
                const candidateName = clickedBox.dataset.candidateName;
                const profileDetailsDiv = clickedBox.querySelector('.profile-details-section');

                // If no profile details or not an election candidate box, do nothing
                if (!profileDetailsDiv) {
                    return;
                }

                // Collapse any currently expanded profile if it's different from the one clicked
                if (expandedCandidate && expandedCandidate !== candidateName) {
                    const prevExpandedBox = DOM.detailsPanel.querySelector(`.candidate-box[data-candidate-name="${expandedCandidate}"]`);
                    if (prevExpandedBox) {
                        prevExpandedBox.querySelector('.profile-details-section').classList.add('hidden');
                        prevExpandedBox.classList.remove('expanded');
                    }
                }

                // Toggle the clicked profile's visibility
                profileDetailsDiv.classList.toggle('hidden');
                clickedBox.classList.toggle('expanded');

                // Update the tracking variable
                if (!profileDetailsDiv.classList.contains('hidden')) {
                    expandedCandidate = candidateName;
                } else {
                    expandedCandidate = null;
                }
            }

            /**
             * Handles the click on a 'Vote' button within a candidate's expanded profile.
             * Adds/removes the candidate from selectedOptions and updates UI.
             * @param {Event} e - The click event.
             */
            function handleVoteClick(e) {
                const voteButton = e.target.closest('.vote-button');
                if (!voteButton) return; // Not a vote button click

                e.stopPropagation(); // Prevent the click from bubbling up and collapsing the profile

                const candidateName = voteButton.dataset.candidateName;
                const maxSelections = currentAction.metadata['674'].pollDetails.maxSelections;
                const candidateBox = voteButton.closest('.candidate-box');
                const votedIndicator = candidateBox.querySelector('.voted-indicator');

                if (selectedOptions.includes(candidateName)) {
                    // Candidate is already selected, remove them (toggle off)
                    selectedOptions = selectedOptions.filter(opt => opt !== candidateName);
                    voteButton.textContent = 'Vote for this candidate';
                    voteButton.classList.replace('bg-indigo-600', 'bg-purple-600');
                    voteButton.classList.replace('hover:bg-indigo-700', 'hover:bg-purple-700');
                    if (votedIndicator) votedIndicator.classList.add('hidden');
                } else {
                    // Candidate is not selected, add them if max selections not reached
                    if (selectedOptions.length < maxSelections) {
                        selectedOptions.push(candidateName);
                        voteButton.textContent = 'Voted!';
                        voteButton.classList.replace('bg-purple-600', 'bg-indigo-600');
                        voteButton.classList.replace('hover:bg-purple-700', 'hover:bg-indigo-700');
                        if (votedIndicator) votedIndicator.classList.remove('hidden');
                    } else {
                        showFeedback(`You can select a maximum of ${maxSelections} candidates.`);
                    }
                }

                renderRankedList();
                updateSubmissionUI();
            }


            /**
             * Simulates wallet submission of a vote.
             */
            function handleSubmitWallet() {
                const statusEl = DOM.detailsPanel.querySelector('#submission-status');
                // Disable buttons during submission
                DOM.detailsPanel.querySelector('#submit-wallet-btn').disabled = true;
                DOM.detailsPanel.querySelector('#manual-submit-btn').disabled = true;
                statusEl.textContent = 'Please sign the transaction in your wallet...';

                // Simulate a delay for signing/submission
                setTimeout(() => {
                    // Generate a fake transaction ID for the receipt link
                    const fakeTxId = [...Array(64)].map(() => Math.floor(Math.random() * 16).toString(16)).join('');
                    const scanUrl = `https://sancho.cardanoscan.io/transaction/${fakeTxId}`;
                    statusEl.innerHTML = `<div class="bg-teal-100 dark:bg-teal-900/50 border border-teal-300 dark:border-teal-700 text-teal-800 dark:text-teal-300 text-sm p-3 rounded-lg"><span>Vote successfully submitted!</span><a href="${scanUrl}" target="_blank" class="text-purple-600 dark:text-purple-400 hover:text-purple-500 dark:hover:text-purple-300 underline font-semibold ml-2">View Receipt</a></div>`;
                    showMockResults(); // Display mock results after submission
                }, 2000);
            }

            /**
             * Updates the visibility and state of the submission buttons.
             */
            function updateSubmissionUI() {
                const submissionContainer = DOM.detailsPanel.querySelector('#submission-container');
                if (!submissionContainer) return; // Exit if submission container not found (e.g., non-poll action)

                const pollDetails = currentAction?.metadata?.['674']?.pollDetails;
                // Only show submission options if it's a poll and at least one option is selected
                if (!pollDetails || selectedOptions.length === 0) {
                    submissionContainer.classList.add('hidden');
                    return;
                }
                submissionContainer.classList.remove('hidden');

                // Enable/disable wallet submission button based on wallet connection status
                const submitWalletBtn = DOM.detailsPanel.querySelector('#submit-wallet-btn');
                submitWalletBtn.disabled = !isWalletConnected;
                
                // Attach event listeners for submission buttons (once to prevent multiple listeners)
                // Ensure previous listeners are removed to avoid duplicates
                submitWalletBtn.removeEventListener('click', handleSubmitWallet); 
                submitWalletBtn.addEventListener('click', handleSubmitWallet, { once: true });

                const manualSubmitBtn = DOM.detailsPanel.querySelector('#manual-submit-btn');
                manualSubmitBtn.removeEventListener('click', renderManualSubmission); 
                manualSubmitBtn.addEventListener('click', renderManualSubmission, { once: true });
            }
            
            /**
             * Displays temporary feedback messages to the user using a custom modal.
             * @param {string} message - The message to display.
             */
            function showFeedback(message) {
                DOM.modalMessage.textContent = message;
                DOM.feedbackModal.classList.remove('hidden');
                // Auto-hide the modal after a few seconds if it's not an error/persistent message
                setTimeout(() => {
                    DOM.feedbackModal.classList.add('hidden');
                }, 3000); // Display for 3 seconds
            }


            /**
             * Displays mock poll results after a vote submission.
             * Results are randomly generated and incremented for selected options.
             */
            function showMockResults() {
                const resultsContainer = DOM.detailsPanel.querySelector('#results-container');
                if (!resultsContainer) return;

                const resultsOutput = document.createElement('div');
                resultsOutput.className = 'space-y-4';
                resultsContainer.innerHTML = '<h3 class="text-xl font-semibold text-primary mb-4 border-t border-theme pt-6">Live Poll Results</h3>';
                resultsContainer.appendChild(resultsOutput);
                resultsContainer.classList.remove('hidden'); // Show the results container

                // Generate random mock results for all options
                const mockResults = currentAction.metadata['674'].pollDetails.options.reduce((acc, opt) => {
                    acc[opt] = Math.floor(Math.random() * 500) + 50; // Random votes between 50 and 550
                    return acc;
                }, {});

                // Increment votes for selected options to make it seem like the vote counted
                selectedOptions.forEach(opt => {
                    mockResults[opt] += 1;
                });

                const totalVotes = Object.values(mockResults).reduce((sum, val) => sum + val, 0); // Calculate total votes
                resultsOutput.innerHTML = ''; // Clear previous results

                // Render each option's results with a progress bar
                for (const [option, votes] of Object.entries(mockResults)) {
                    const percentage = totalVotes > 0 ? ((votes / totalVotes) * 100).toFixed(1) : 0;
                    resultsOutput.innerHTML += `
                        <div>
                            <div class="flex justify-between items-center mb-1 font-medium text-primary">
                                <span>${option.replace(/&/g, '&amp;')}</span>
                                <span class="text-tertiary">${votes} votes</span>
                            </div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2.5">
                                <div class="bg-gradient-to-r from-purple-500 to-pink-500 h-2.5 rounded-full" style="width: ${percentage}%"></div>
                            </div>
                        </div>
                    `;
                }
            }

            // Initialize the application when the DOM is ready
            init();
        });
    </script>
</body>
</html>
